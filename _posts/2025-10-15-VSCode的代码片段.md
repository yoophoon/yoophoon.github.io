---
title: VSCode的文本片段
abbrlink: cc2b6119
date: 2025-10-15 23:07:14
updated:
tags:
  - vscode
  - snippet
categories:
  - [vscode,snippet]
keywords: vscode,snippet
description: 使用VSCode的文本片段，加速文本编辑工作
top_img:
cover:
comments:
toc:
toc_number:
toc_style_simple:
copyright:
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
mathjax:
katex:
aplayer:
highlight_shrink:
aside:
abcjs:
noticeOutdate:
---


# [VSCode的文本片段](https://code.visualstudio.com/docs/editing/userdefinedsnippets)
{% note info flat %}
vscode支持`TextMate snippet syntax`，但不支持其`interpolated shell code`及`\u`的使用。
{% endnote %}

## 内置文本片段
通过命令面板（快捷键：`Ctrl+Shift+P`）输入插入片段（Insert Snippet）查看当前文件支持的文本片段。
{% note info simple %}
列表包含VSCode内置文本片段、用户自定义文本片段及扩展提供的文本片段。
{% endnote %}

## 安装带文本片段扩展
在插件市场（`Ctrl+Shift+X`）使用过滤器：分类→文本片段（category:"snippets"）即可检索带文本片段的插件。
{% note info flat %}
使用过滤器后搜索栏会出现`@category:"snippets"`字样。
{% endnote %}

## 创建自定义文本片段
`File→Preferences→Configure Snippets`和`Setting→Snippets`都可选择对应文件类型创建代码片段文件，也可以通过命令面板直接输入`Configure Snippets`进行操作。

### 文本片段示例
```JSON
// in file 'Code/User/snippets/javascript.json'
{
  "For Loop": {
    "prefix": ["for", "for-const"],
    "body": ["for (const ${2:element} of ${1:array}) {", "\t$0", "}"],
    "description": "A for loop."
  }
}
```

- "For Loop": 文本片段名，如果文本片段没有提供"description"的话，文本片段名将会被显示
- "prefix": 触发文本片段智能提示的文本
- "body": 被插入文件的文本，数组的每个元素表示一行
- "description": 文本片段的简短描述

{% note info flat %}
官方说代码片段还有一个字段`isFileTemplate`用来给填充或替换当前文件内容，经测试该字段似乎被移除了，另外官方说的`Snippets: Populate File from Snippet`命令在当前VSCode版本也没了，取而代之的命令是`Snippets: Fill File with Snippet`，效果与官网描述的功能一致，但不需要在定义文本片段时添加`isFileTemplate`字段。
{% endnote %}

### 文本片段的作用域
文本片段的作用域主要由下面两种方式限定：
1. 语言（文件类型）
2. 项目
文本片段可以限定在指定语言、多语言及全局范围，这些限定通过文本片段的定义方式生效。如定义在`javascript.json`文件中的文本片段则只会在js语言（文件类型）生效，而多语言及全局文本片段则定义在后缀为`.code-snippets`文件中。在全局文本片段文件中，文本片段会有一个额外的有效字段`scope`用于指定其作用域，如果未提供该字段则该文本片段会被认为是在全局作用域生效。

命令`Configure Snippet`创建作用于当前项目的文本片段，文本片段文件位于项目根目录`.vscode/userdefinedsnippets.code-snippets`，文件内容于上文提到的多语言及全局文本片段文件内容定义一致，这有利于与项目成员分享当前项目用到的文本片段。

## 文本片段语法
文本片段语法主要用于编写定义文本片段的`body`属性。
### Tabstops|定位点
使用`$+number`定义定位点，使用`$0`定义最后光标停留的位置。
### Placeholders|占位符
使用`${1:placeholder}`定义带占位符的定位点，这样定位点就会默认显示这些占位符，当光标跳转至该定位点时可以很轻松的修改这些占位符，另外，占位符是可以嵌套的，这意味着可以定义`${1:placeholder ${2:another}}`这样的占位符。
### Choice|可选项
使用`${1|foo,bar,more|}`定义可选项定位点，当光标跳转至该定位点时则会出现定义的列表供选择。
### Variables|变量
使用`$name`或`${name:default}`定义带变量值的定位点，如果该变量没有被设置，则会插入其默认值或空字符串，而如果该变量为位置变量则会插入其变量名。VSCode的文本片段可用变量如下所示：
- `TM_SELECTED_TEXT` The currently selected text or the empty string
- `TM_CURRENT_LINE` The contents of the current line
- `TM_CURRENT_WORD` The contents of the word under cursor or the empty string
- `TM_LINE_INDEX` The zero-index based line number
- `TM_LINE_NUMBER` The one-index based line number
- `TM_FILENAME` The filename of the current document
- `TM_FILENAME_BASE` The filename of the current document without its extensions
- `TM_DIRECTORY` The directory of the current document
- `TM_FILEPATH` The full file path of the current document
- `RELATIVE_FILEPATH` The relative (to the opened workspace or folder) file path of the current document
- `CLIPBOARD` The contents of your clipboard
- `WORKSPACE_NAME` The name of the opened workspace or folder
- `WORKSPACE_FOLDER` The path of the opened workspace or folder
- `CURSOR_INDEX` The zero-index based cursor number
- `CURSOR_NUMBER` The one-index based cursor number

For inserting the current date and time:
- `CURRENT_YEAR` The current year
- `CURRENT_YEAR_SHORT` The current year's last two digits
- `CURRENT_MONTH` The month as two digits (example '02')
- `CURRENT_MONTH_NAME` The full name of the month (example 'July')
- `CURRENT_MONTH_NAME_SHORT` The short name of the month (example 'Jul')
- `CURRENT_DATE` The day of the month as two digits (example '08')
- `CURRENT_DAY_NAME` The name of day (example 'Monday')
- `CURRENT_DAY_NAME_SHORT` The short name of the day (example 'Mon')
- `CURRENT_HOUR` The current hour in 24-hour clock format
- `CURRENT_MINUTE` The current minute as two digits
- `CURRENT_SECOND` The current second as two digits
- `CURRENT_SECONDS_UNIX` The number of seconds since the Unix epoch
- `CURRENT_TIMEZONE_OFFSET` The current UTC time zone offset as `+HH:MM` or `-HH:MM` (example `-07:00`).

For inserting random values:
- `RANDOM` 6 random Base-10 digits
- `RANDOM_HEX` 6 random Base-16 digits
- `UUID` A Version 4 UUID

For inserting line or block comments, honoring the current language:
- `BLOCK_COMMENT_START` Example output: in PHP `/*` or in HTML `<!--`
- `BLOCK_COMMENT_END` Example output: in PHP `*/` or in HTML `-->`
- `LINE_COMMENT` Example output: in PHP `//`

下面的文本片段会在js文件中插入`/* hello world */`，在html文件中插入`<!-- hello world -->`:
```JSON
{
  "hello": {
    "scope": "javascript,html",
    "prefix": "hello",
    "body": "$BLOCK_COMMENT_START hello world $BLOCK_COMMENT_END"
  }
}
```
### Variable Transforms|变量变换
变量变换允许变量值在被插入之前被修改。变量变换的定义由3部分组成：
- 正则表达式|regular expression，用来匹配变量的值，如果匹配失败则为空字符串
- 格式字符串|format string，允许引用正则表达式分组。格式字符串允许条件插入及简单修改
- 表达式选项|options，指定正则表达式的工作方式
下面的例子会插入当前文件名而忽略后缀，比如，文件名为`foo.txt`的文件会获得`foo`的内容：
```text
${TM_FILENAME/(.*)\\..+$/$1/}
  |           |         |  |
  |           |         |  |-> no options
  |           |         |
  |           |         |-> references the contents of the first
  |           |             capture group
  |           |
  |           |-> regex to capture everything before
  |               the final `.suffix`
  |
  |-> resolves to the filename
```
### Placeholder-Transform|占位符变换
和`变量变换`类似，`占位符变换`也允许光标在移动到下个`定位点时`改变插入的值。插入的文本会被正则表达式匹配并且匹配的内容会被指定的格式文本替换。每个`占位符`都能独立的定义自己的占位符变换。
### Transform example|转换用例
双引号内的用例文本和出现在文本片段body属性中的一样，文本内的`\`转义符号本身需要被转义一次（否则解释器会转义`\`后面的字符）。例如文件名`example-123.456-TEST.js`的简单变换及输出结果：
|用例|输出|解释|
|:--|:--|:--|
|`"${TM_FILENAME/[\\.]/_/}"`|`example-123_456-TEST.js`|Replace the first . with _|
|`"${TM_FILENAME/[\\.-]/_/g}"`|`example_123_456_TEST_js`|Replace each . or - with _|
|`"${TM_FILENAME/(.*)/${1:/upcase}/}"`|`EXAMPLE-123.456-TEST.JS`|Change to all uppercase|
|`"${TM_FILENAME/[^0-9a-z]//gi}"`|`example123456TESTjs`|Remove non-alphanumeric characters|

## Grammar|文本片段形式语法
下面是文本片段使用的EBNF（extended Backus-Naur form|扩展巴科斯范式）。使用`\`转义一些字符，比如`$`,`}`,`\`,`,`,`|`。只有在需要被转义的时候使用转义符号，否则会导致文本片段的指定失效，如定位点、占位符等。
```Text
any         ::= tabstop | placeholder | choice | variable | text
tabstop     ::= '$' int
                | '${' int '}'
                | '${' int  transform '}'
placeholder ::= '${' int ':' any '}'
choice      ::= '${' int '|' text (',' text)* '|}'
variable    ::= '$' var | '${' var '}'
                | '${' var ':' any '}'
                | '${' var transform '}'
transform   ::= '/' regex '/' (format | text)+ '/' options
format      ::= '$' int | '${' int '}'
                | '${' int ':' '/upcase' | '/downcase' | '/capitalize' | '/camelcase' | '/pascalcase' '}'
                | '${' int ':+' if '}'
                | '${' int ':?' if ':' else '}'
                | '${' int ':-' else '}' | '${' int ':' else '}'
regex       ::= JavaScript Regular Expression value (ctor-string)
options     ::= JavaScript Regular Expression option (ctor-options)
var         ::= [_a-zA-Z] [_a-zA-Z0-9]*
int         ::= [0-9]+
text        ::= .*
if          ::= text
else        ::= text
```

# [Using TextMate snippets|使用TextMate文本片段](https://code.visualstudio.com/api/language-extensions/snippet-guide#_using-textmate-snippets)

# Assign keyboard shortcuts to snippets|绑定快捷键至文本片段
打开`keybindings.json`(Preferences: Open Keyboard Shortcuts，这个文件定义了所有快捷键）并添加快捷键传递`"snippet"`键值对作为额外的参数：
```JSON
{
  "key": "cmd+k 1",
  "command": "editor.action.insertSnippet",
  "when": "editorTextFocus",
  "args": {
    "snippet": "console.log($1)$0"
  }
}
```
快捷键会调用`Insert Snippet|插入文本片段`命令而非弹窗选择一个文本片段，这会插入被提供的文本片段。像其他快捷键一样用快捷键、命令ID及可选的当前句子上下文定义文本片段快捷键。
此外，除了使用`snippet`参数值定义文本片段外，还可以通过`langId`和`name`参数引用已有的文本片段。`langId`参数选择文本片段定义的作用范围，而`name`对应的文本片段则会被插入。比如，下面简单的用例选择用于`csharp`文件的`myFavSnippet`:
```JSON
{
  "key": "cmd+k 1",
  "command": "editor.action.insertSnippet",
  "when": "editorTextFocus",
  "args": {
    "langId": "csharp",
    "name": "myFavSnippet"
  }
}
```
# 常见问题
## 怎么从智能提示中移除文本片段选项
在`Insert Snippet`命令的下拉列表的右边有个`Hide from IntelliSense`按钮用于隐藏对应文本片段在只能提示中的显示。这只会导致只能提示不再显示该文本片段，但文本片段依旧可以使用命令`Insert Snippet`选中并插入至当前文件。
